<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="oov" />
  <title>PSD アニメーション効果</title>
  <script src="assets/script-builder.js"></script>
  <style type="text/css">
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
<link rel="stylesheet" href="assets/style.css">
</head>
<body>
<div id="ptk-outer">
<div id="ptk-menu" class="ptk-selected-psd">
  <ul>
    <li class="ptk-menu-item-index"><a href="index.html">はじめに</a></li>
    <li class="ptk-menu-item-tutorial"><a href="tutorial.html">チュートリアル</a></li>
    <li class="ptk-menu-item-tutorial2"><a href="tutorial2.html">ツール連携入門</a></li>
    <li class="ptk-menu-item-pfv"><a href="pfv.html">PSDTool のお気に入りを使う</a></li>
    <li class="ptk-menu-item-forcepser"><a href="forcepser.html">かんしくん</a></li>
    <li class="ptk-menu-item-obj ptk-menu-item-psd ptk-menu-item-subobj ptk-menu-item-prep ptk-menu-item-audio">オブジェクトリファレンス
      <ul>
        <li class="ptk-menu-item-obj"><a href="obj.html">独自のオブジェクト</a>
          <ul>
            <li><a href="obj.html#PSD_.E3.83.95.E3.82.A1.E3.82.A4.E3.83.AB.E3.82.AA.E3.83.96.E3.82.B8.E3.82.A7.E3.82.AF.E3.83.88">PSD ファイルオブジェクト</a></li>
            <li><a href="obj.html#.E5.AD.97.E5.B9.95.E8.A1.A8.E7.A4.BA">字幕表示</a></li>
          </ul>
        </li>
        <li class="ptk-menu-item-psd"><a href="psd.html">PSD アニメーション効果</a>
          <ul>
            <li><a href="psd.html#.E7.9B.AE.E3.83.91.E3.83.81.40PSD">目パチ</a> | <a href="psd.html#.E7.9B.AE.E3.83.91.E3.83.81_.E3.82.92_Lua_.E3.82.B9.E3.82.AF.E3.83.AA.E3.83.97.E3.83.88.E3.81.8B.E3.82.89.E4.BD.BF.E3.81.86">フォーム</a></li>
            <li><a href="psd.html#.E5.8F.A3.E3.83.91.E3.82.AF_.E9.96.8B.E9.96.89.E3.81.AE.E3.81.BF.40PSD">口パク 開閉のみ</a> | <a href="psd.html#.E5.8F.A3.E3.83.91.E3.82.AF_.E9.96.8B.E9.96.89.E3.81.AE.E3.81.BF_.E3.82.92_Lua_.E3.82.B9.E3.82.AF.E3.83.AA.E3.83.97.E3.83.88.E3.81.8B.E3.82.89.E4.BD.BF.E3.81.86">フォーム</a></li>
            <li><a href="psd.html#.E5.8F.A3.E3.83.91.E3.82.AF_.E3.81.82.E3.81.84.E3.81.86.E3.81.88.E3.81.8A.40PSD">口パク あいうえお</a> | <a href="psd.html#.E5.8F.A3.E3.83.91.E3.82.AF_.E3.81.82.E3.81.84.E3.81.86.E3.81.88.E3.81.8A_.E3.82.92_Lua_.E3.82.B9.E3.82.AF.E3.83.AA.E3.83.97.E3.83.88.E3.81.8B.E3.82.89.E4.BD.BF.E3.81.86">フォーム</a></li>
          </ul>
        </li>
        <li class="ptk-menu-item-subobj"><a href="subobj.html">subobj アニメーション効果</a></li>
        <li class="ptk-menu-item-otheranm"><a href="otheranm.html">その他のアニメーション効果</a></li>
        <li class="ptk-menu-item-prep"><a href="prep.html">準備オブジェクト</a></li>
        <li class="ptk-menu-item-audio"><a href="audio.html">音声フィルタ</a></li>
      </ul>
    </li>
    <li class="ptk-menu-item-plugins"><a href="plugins.html">付属プラグイン</a></li>
    <li class="ptk-menu-item-setting"><a href="setting.html">設定</a></li>
    <li class="ptk-menu-item-faq"><a href="faq.html">よくある質問</a></li>
  </ul>
</div>
<div id="ptk-main">
<header>
<h1 class="title">PSD アニメーション効果</h1>
</header>
<nav id="TOC">
<ul>
<li><a href="#PSD_.E3.82.A2.E3.83.8B.E3.83.A1.E3.83.BC.E3.82.B7.E3.83.A7.E3.83.B3.E5.8A.B9.E6.9E.9C.E3.81.AB.E3.81.A4.E3.81.84.E3.81.A6">PSD アニメーション効果について</a></li>
<li><a href="#.E6.8F.8F.E7.94.BB.40PSD">描画@PSD</a></li>
<li><a href="#.E7.9B.AE.E3.83.91.E3.83.81.40PSD">目パチ@PSD</a><ul>
<li><a href="#.E7.9B.AE.E3.83.91.E3.83.81_.E3.82.92_Lua_.E3.82.B9.E3.82.AF.E3.83.AA.E3.83.97.E3.83.88.E3.81.8B.E3.82.89.E4.BD.BF.E3.81.86"><code>目パチ</code> を Lua スクリプトから使う</a></li>
</ul></li>
<li><a href="#.E5.8F.A3.E3.83.91.E3.82.AF_.E9.96.8B.E9.96.89.E3.81.AE.E3.81.BF.40PSD">口パク 開閉のみ@PSD</a><ul>
<li><a href="#.E5.8F.A3.E3.83.91.E3.82.AF_.E9.96.8B.E9.96.89.E3.81.AE.E3.81.BF_.E3.82.92_Lua_.E3.82.B9.E3.82.AF.E3.83.AA.E3.83.97.E3.83.88.E3.81.8B.E3.82.89.E4.BD.BF.E3.81.86"><code>口パク 開閉のみ</code> を Lua スクリプトから使う</a></li>
</ul></li>
<li><a href="#.E5.8F.A3.E3.83.91.E3.82.AF_.E3.81.82.E3.81.84.E3.81.86.E3.81.88.E3.81.8A.40PSD">口パク あいうえお@PSD</a><ul>
<li><a href="#.E5.8F.A3.E3.83.91.E3.82.AF_.E3.81.82.E3.81.84.E3.81.86.E3.81.88.E3.81.8A_.E3.82.92_Lua_.E3.82.B9.E3.82.AF.E3.83.AA.E3.83.97.E3.83.88.E3.81.8B.E3.82.89.E4.BD.BF.E3.81.86"><code>口パク あいうえお</code> を Lua スクリプトから使う</a></li>
<li><a href="#.E3.82.82.E3.81.A3.E3.81.A8.E6.9F.94.E8.BB.9F.E3.81.AB_Lua_.E3.82.B9.E3.82.AF.E3.83.AA.E3.83.97.E3.83.88.E3.81.8B.E3.82.89.E5.88.B6.E5.BE.A1.E3.81.99.E3.82.8B">もっと柔軟に Lua スクリプトから制御する</a></li>
</ul></li>
<li><a href="#.E3.83.91.E3.83.BC.E3.83.84.E5.B7.AE.E3.81.97.E6.9B.BF.E3.81.88.40PSD">パーツ差し替え@PSD</a></li>
</ul>
</nav>
<h2 id="PSD_.E3.82.A2.E3.83.8B.E3.83.A1.E3.83.BC.E3.82.B7.E3.83.A7.E3.83.B3.E5.8A.B9.E6.9E.9C.E3.81.AB.E3.81.A4.E3.81.84.E3.81.A6">PSD アニメーション効果について</h2>
<p>PSDToolKit で予め用意されているアニメーション効果のうち、名前の接尾辞が <code>@PSD</code> になっているものは <strong>PSD ファイルを描画するまでの間に使用するアニメーション効果</strong>です。</p>
<p><a href="obj.html#PSD_.E3.83.95.E3.82.A1.E3.82.A4.E3.83.AB.E3.82.AA.E3.83.96.E3.82.B8.E3.82.A7.E3.82.AF.E3.83.88">PSD ファイルオブジェクト</a>には任意の個数の PSD アニメーション効果や PSD ファイルからエクスポートしたアニメーション効果を並べることができ、最後に <a href="#.E6.8F.8F.E7.94.BB.40PSD"><code>描画</code></a> を置くことで画面に描画されます。</p>
<p>ひとつのオブジェクトに足せるアニメーション効果は10個までですが、必要であれば下のレイヤーにアニメーション効果を単独で配置することで更に増やすこともできます。</p>
<h2 id=".E6.8F.8F.E7.94.BB.40PSD">描画@PSD</h2>
<p><code>描画</code> は準備されたデータを元に画面への描画を行うアニメーション効果です。</p>
<p>描画を行った時点でその PSD ファイルオブジェクトは描画完了状態になり、そのフレーム内でそれ以上のレイヤー変更などはできなくなります。</p>
<table>
<thead>
<tr class="header">
<th>プロパティ名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>反転</code></td>
<td>画像を反転させます。<br><code>-1</code> - PSDToolKit ウィンドウでの設定に従う<br><code>0</code> - 反転なし<br><code>1</code> - 左右反転<br><code>2</code> - 上下反転<br><code>3</code> - 上下左右反転</td>
</tr>
<tr class="even">
<td><code>縮小率</code></td>
<td>元のサイズより画像を縮小して表示します。<br>ここで縮小しても描画負荷はほとんど下がらないため、動作が重いのを回避したい場合は PSD ファイル自体を縮小しておく必要があります。</td>
</tr>
<tr class="odd">
<td><code>オフセットX</code></td>
<td>オブジェクト内での描画位置をX方向にずらします。</td>
</tr>
<tr class="even">
<td><code>オフセットY</code></td>
<td>オブジェクト内での描画位置をY方向にずらします。</td>
</tr>
</tbody>
</table>
<h2 id=".E7.9B.AE.E3.83.91.E3.83.81.40PSD">目パチ@PSD</h2>
<p><code>目パチ</code> は目パチを実現するための <code>アニメーション効果</code> です。</p>
<p>少なくとも開いた目と閉じた目の２種類のレイヤーが必要です。</p>
<table>
<thead>
<tr class="header">
<th>プロパティ名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>間隔(秒)</code></td>
<td>次に目パチのアニメーションを始めるまでの秒数です。</td>
</tr>
<tr class="even">
<td><code>速さ</code></td>
<td>目パチの速さをフレーム単位で指定します。</td>
</tr>
<tr class="odd">
<td><code>オフセット</code></td>
<td>目パチを始めるタイミングをずらします。<br>複数キャラクターに <code>目パチ</code> を設定するとそのままでは同時に目パチしてしまうので、必要に応じて <code>オフセット</code> で調整してください。</td>
</tr>
</tbody>
</table>
<p><code>設定</code> ボタンを押すと以下のプロパティがあります。</p>
<table>
<thead>
<tr class="header">
<th>プロパティ名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>開き</code><br><code>ほぼ開き</code><br><code>半開き</code><br><code>ほぼ閉じ</code><br><code>閉じ</code></td>
<td>表示するレイヤーを割り当てます。</td>
</tr>
</tbody>
</table>
<h3 id=".E7.9B.AE.E3.83.91.E3.83.81_.E3.82.92_Lua_.E3.82.B9.E3.82.AF.E3.83.AA.E3.83.97.E3.83.88.E3.81.8B.E3.82.89.E4.BD.BF.E3.81.86"><code>目パチ</code> を Lua スクリプトから使う</h3>
<p>以下のフォームを使うと、スクリプト内で使用可能な目パチオブジェクトを作成できます。</p>
<form id="blinker-builder" class="ptk-script-builder">
<dl>
<dt>開き</dt><dd><input type="text" name="m4" autocomplete="off" placeholder="例: v1.!目/*開き"></dd>
<dt>ほぼ開き</dt><dd><input type="text" name="m3" autocomplete="off" placeholder="例: v1.!目/*ほぼ開き"></dd>
<dt>半開き</dt><dd><input type="text" name="m2" autocomplete="off" placeholder="例: v1.!目/*半開き"></dd>
<dt>ほぼ閉じ</dt><dd><input type="text" name="m1" autocomplete="off" placeholder="例: v1.!目/*ほぼ閉じ"></dd>
<dt>閉じ</dt><dd><input type="text" name="m0" autocomplete="off" placeholder="例: v1.!目/*閉じ"></dd>
</dl>
<dl>
<dt>間隔(秒)</dt><dd><input type="text" name="interval" autocomplete="off" value="4" placeholder="例: 4"></dd>
<dt>速さ</dt><dd><input type="text" name="speed" autocomplete="off" value="1" placeholder="例: 1"></dd>
<dt>オフセット</dt><dd><input type="text" name="offset" autocomplete="off" value="0" placeholder="例: 0"></dd>
</dl>
<dl>
<dt>出力</dt><dd><input type="text" name="output" value="" readonly="readonly"></dd><dd><button type="button" name="copy">クリップボードにコピー</button></dd>
</dl>
</form>

<p>上記フォームで作成されるものは以下のコードと同等です。</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb1-1" title="1"><span class="co">-- 上から順に 閉じ から 開き へのパターンを入れておく</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">local</span> patterns <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="st">&quot;v1.!目/*閉じ&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-4" title="4">  <span class="st">&quot;v1.!目/*ほぼ閉じ&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-5" title="5">  <span class="st">&quot;v1.!目/*半目&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-6" title="6">  <span class="st">&quot;v1.!目/*ほぼ開き&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-7" title="7">  <span class="st">&quot;v1.!目/*開き&quot;</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="op">}</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="kw">local</span> interval <span class="op">=</span> <span class="dv">4</span> <span class="co">-- 間隔(秒)</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="kw">local</span> speed    <span class="op">=</span> <span class="dv">1</span> <span class="co">-- 速さ</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="kw">local</span> offset   <span class="op">=</span> <span class="dv">0</span> <span class="co">-- オフセット</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="kw">local</span> blinker <span class="op">=</span> <span class="fu">require</span><span class="op">(</span><span class="st">&quot;PSDToolKit&quot;</span><span class="op">).</span>Blinker<span class="op">.</span>new<span class="op">(</span>patterns<span class="op">,</span> interval<span class="op">,</span> speed<span class="op">,</span> offset<span class="op">)</span> <span class="co">-- 目パチオブジェクトを生成</span></a>
<a class="sourceLine" id="cb1-13" title="13"></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="co">-- 実際に使用する場合は以下のように PSD:addstate に与えます</span></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="co">-- PSD:addstate(blinker)</span></a></code></pre></div>
<h2 id=".E5.8F.A3.E3.83.91.E3.82.AF_.E9.96.8B.E9.96.89.E3.81.AE.E3.81.BF.40PSD">口パク 開閉のみ@PSD</h2>
<p><code>口パク 開閉のみ</code> は開閉のみのシンプルなアニメーションで、<a href="#.E7.9B.AE.E3.83.91.E3.83.81.40PSD"><code>目パチ</code></a> と同じ要領で設定できます。</p>
<table>
<thead>
<tr class="header">
<th>プロパティ名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>速さ</code></td>
<td>口パクのアニメーション速度をフレーム単位で指定します。</td>
</tr>
<tr class="even">
<td><code>口パク準備がなくても有効</code></td>
<td>チェックを入れると、<code>口パク準備</code> のオブジェクトがない区間でも <code>閉じ</code> のパターンが適用されるようになります。</td>
</tr>
</tbody>
</table>
<p><code>設定</code> ボタンを押すと以下のプロパティがあります。</p>
<table>
<thead>
<tr class="header">
<th>プロパティ名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>開き</code><br><code>ほぼ開き</code><br><code>半開き</code><br><code>ほぼ閉じ</code><br><code>閉じ</code></td>
<td>表示するレイヤーを割り当てます。</td>
</tr>
</tbody>
</table>
<h3 id=".E5.8F.A3.E3.83.91.E3.82.AF_.E9.96.8B.E9.96.89.E3.81.AE.E3.81.BF_.E3.82.92_Lua_.E3.82.B9.E3.82.AF.E3.83.AA.E3.83.97.E3.83.88.E3.81.8B.E3.82.89.E4.BD.BF.E3.81.86"><code>口パク 開閉のみ</code> を Lua スクリプトから使う</h3>
<p>以下のフォームを使うと、スクリプト内で使用可能な口パクオブジェクトを作成できます。</p>
<form id="lipsyncsimple-builder" class="ptk-script-builder">
<dl>
<dt>開き</dt><dd><input type="text" name="m4" autocomplete="off" placeholder="例: v1.!口/*開き"></dd>
<dt>ほぼ開き</dt><dd><input type="text" name="m3" autocomplete="off" placeholder="例: v1.!口/*ほぼ開き"></dd>
<dt>半開き</dt><dd><input type="text" name="m2" autocomplete="off" placeholder="例: v1.!口/*半開き"></dd>
<dt>ほぼ閉じ</dt><dd><input type="text" name="m1" autocomplete="off" placeholder="例: v1.!口/*ほぼ閉じ"></dd>
<dt>閉じ</dt><dd><input type="text" name="m0" autocomplete="off" placeholder="例: v1.!口/*閉じ"></dd>
</dl>
<dl>
<dt>速さ</dt><dd><input type="text" name="speed" autocomplete="off" value="1" placeholder="例: 1"></dd>
<dt>オプション</dt><dd><label><input type="checkbox" name="alwaysapply" autocomplete="off" value="1" checked="checked">口パク準備がなくても有効</label></dd>
</dl>
<dl>
<dt>出力</dt><dd><input type="text" name="output" value="" readonly="readonly"></dd><dd><button type="button" name="copy">クリップボードにコピー</button></dd>
</dl>
</form>

<p>上記フォームで作成されるものは以下のコードと同等です。</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb2-1" title="1"><span class="co">-- 上から順に 閉じ から 開き へのパターンを入れておく</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">local</span> patterns <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="st">&quot;v1.!口/*閉じ&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="st">&quot;v1.!口/*ほぼ閉じ&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="st">&quot;v1.!口/*半開き&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-6" title="6">  <span class="st">&quot;v1.!口/*ほぼ開き&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-7" title="7">  <span class="st">&quot;v1.!口/*開き&quot;</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="op">}</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="kw">local</span> speed <span class="op">=</span> <span class="dv">1</span> <span class="co">-- 速さ</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="kw">local</span> alwaysapply <span class="op">=</span> <span class="kw">true</span> <span class="co">-- 口パク準備がなくても有効</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="kw">local</span> lipsync <span class="op">=</span> <span class="fu">require</span><span class="op">(</span><span class="st">&quot;PSDToolKit&quot;</span><span class="op">).</span>LipSyncSimple<span class="op">.</span>new<span class="op">(</span>patterns<span class="op">,</span> speed<span class="op">,</span> alwaysapply<span class="op">)</span> <span class="co">-- 口パクオブジェクトを生成</span></a>
<a class="sourceLine" id="cb2-12" title="12"></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="co">-- 実際に使用する場合は以下のように PSD:addstate に与えます</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="co">-- PSD:addstate(lipsync)</span></a></code></pre></div>
<h2 id=".E5.8F.A3.E3.83.91.E3.82.AF_.E3.81.82.E3.81.84.E3.81.86.E3.81.88.E3.81.8A.40PSD">口パク あいうえお@PSD</h2>
<p><code>口パク あいうえお</code> は母音の形に合わせてアニメーションを行うタイプのアニメーションで、<code>あ</code> / <code>い</code> / <code>う</code> / <code>え</code> / <code>お</code> / <code>ん</code> に対応した表情パターンが必要になります。</p>
<p>また、音声ファイルから自動で母音を認識するような機能は PSDToolKit にはないため、<code>口パク準備</code> を使う際には <code>*.wav</code> ファイルと<a href="prep.html#.E5.8F.A3.E3.83.91.E3.82.AF.E6.BA.96.E5.82.99.40PSDToolKit">同名の <code>*.lab</code> ファイルを用意する</a>か、拡張編集の<a href="plugins.html#*.lab_.E3.83.95.E3.82.A1.E3.82.A4.E3.83.AB">タイムラインへ直接 <code>*.lab</code> ファイルをドラッグ＆ドロップ</a>して母音のタイミング情報を認識できる状態にする必要があります。</p>
<table>
<thead>
<tr class="header">
<th>プロパティ名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>子音処理</code></td>
<td>子音の処理方法を指定します。<br><code>0</code> - すべて「ん」として処理する<br><code>1</code> - 口を閉じる子音以外は前の母音を引き継ぐ<br><code>2</code> - 口を閉じる子音以外は前後の母音の形をより小さいもので補間</td>
</tr>
<tr class="even">
<td><code>口パク準備がなくても有効</code></td>
<td>チェックを入れると、<code>口パク準備</code> のオブジェクトがない区間でも <code>閉じ</code> のパターンが適用されるようになります。</td>
</tr>
</tbody>
</table>
<p><code>設定</code> ボタンを押すと以下のプロパティがあります。</p>
<table>
<thead>
<tr class="header">
<th>プロパティ名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>あ</code><br><code>い</code><br><code>う</code><br><code>え</code><br><code>お</code><br><code>ん</code></td>
<td>表示するレイヤーを割り当てます。</td>
</tr>
</tbody>
</table>
<h3 id=".E5.8F.A3.E3.83.91.E3.82.AF_.E3.81.82.E3.81.84.E3.81.86.E3.81.88.E3.81.8A_.E3.82.92_Lua_.E3.82.B9.E3.82.AF.E3.83.AA.E3.83.97.E3.83.88.E3.81.8B.E3.82.89.E4.BD.BF.E3.81.86"><code>口パク あいうえお</code> を Lua スクリプトから使う</h3>
<p>以下のフォームを使うと、スクリプト内で使用可能な口パクオブジェクトを作成できます。</p>
<form id="lipsynclab-builder" class="ptk-script-builder">
<dl>
<dt>あ</dt><dd><input type="text" name="a" autocomplete="off" placeholder="例: v1.!口/*あ"></dd>
<dt>い</dt><dd><input type="text" name="i" autocomplete="off" placeholder="例: v1.!口/*い"></dd>
<dt>う</dt><dd><input type="text" name="u" autocomplete="off" placeholder="例: v1.!口/*う"></dd>
<dt>え</dt><dd><input type="text" name="e" autocomplete="off" placeholder="例: v1.!口/*え"></dd>
<dt>お</dt><dd><input type="text" name="o" autocomplete="off" placeholder="例: v1.!口/*お"></dd>
<dt>ん</dt><dd><input type="text" name="N" autocomplete="off" placeholder="例: v1.!口/*ん"></dd>
</dl>
<dl>
<dt>子音処理</dt><dd><input type="text" name="mode" autocomplete="off" value="1" placeholder="例: 1"></dd>
<dt>オプション</dt><dd><label><input type="checkbox" name="alwaysapply" autocomplete="off" value="1" checked="checked">口パク準備がなくても有効</label></dd>
</dl>
<dl>
<dt>出力</dt><dd><input type="text" name="output" value="" readonly="readonly"></dd><dd><button type="button" name="copy">クリップボードにコピー</button></dd>
</dl>
</form>

<p>上記フォームで作成されるものは以下のコードと同等です。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb3-1" title="1"><span class="co">-- あ/い/う/え/お/ん に相当するパターンを割り当てる</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">local</span> patterns <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-3" title="3">  a <span class="op">=</span> <span class="st">&quot;v1.!口/*あ&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-4" title="4">  i <span class="op">=</span> <span class="st">&quot;v1.!口/*い&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-5" title="5">  u <span class="op">=</span> <span class="st">&quot;v1.!口/*う&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-6" title="6">  e <span class="op">=</span> <span class="st">&quot;v1.!口/*え&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-7" title="7">  o <span class="op">=</span> <span class="st">&quot;v1.!口/*お&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-8" title="8">  <span class="cn">N</span> <span class="op">=</span> <span class="st">&quot;v1.!口/*ん&quot;</span></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="op">}</span></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="kw">local</span> mode <span class="op">=</span> <span class="dv">1</span> <span class="co">-- 子音処理</span></a>
<a class="sourceLine" id="cb3-11" title="11"><span class="kw">local</span> alwaysapply <span class="op">=</span> <span class="kw">true</span> <span class="co">-- 口パク準備がなくても有効</span></a>
<a class="sourceLine" id="cb3-12" title="12"><span class="kw">local</span> lipsync <span class="op">=</span> <span class="fu">require</span><span class="op">(</span><span class="st">&quot;PSDToolKit&quot;</span><span class="op">).</span>LipSyncLab<span class="op">.</span>new<span class="op">(</span>patterns<span class="op">,</span> mode<span class="op">,</span> alwaysapply<span class="op">)</span> <span class="co">-- 口パクオブジェクトを生成</span></a>
<a class="sourceLine" id="cb3-13" title="13"></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="co">-- 実際に使用する場合は以下のように PSD:addstate に与えます</span></a>
<a class="sourceLine" id="cb3-15" title="15"><span class="co">-- PSD:addstate(lipsync)</span></a></code></pre></div>
<h3 id=".E3.82.82.E3.81.A3.E3.81.A8.E6.9F.94.E8.BB.9F.E3.81.AB_Lua_.E3.82.B9.E3.82.AF.E3.83.AA.E3.83.97.E3.83.88.E3.81.8B.E3.82.89.E5.88.B6.E5.BE.A1.E3.81.99.E3.82.8B">もっと柔軟に Lua スクリプトから制御する</h3>
<p><code>口パク あいうえお</code> を使わずに自分でスクリプトを書くこともできます。<br />
このアプローチなら思いのままに動かせるでしょう。</p>
<p>以下はスクリプトの記述例です。</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb4-1" title="1"><span class="co">-- このスクリプトを「口パク　あいうえお」の代わりに挿入することで、</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co">-- 自前の口パク処理を実装できます</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">-- （例えば「スクリプト制御」を追加して dofile(&#39;script\</span><span class="an">\lipsync_example.lua&#39;)</span><span class="co"> など）</span></a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">-- それぞれの音素に対応した口の形</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">-- 必要に応じて好きな子音のパターンの追加もできます</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="kw">local</span> patterns <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-8" title="8">  a <span class="op">=</span> <span class="st">&quot;v1.!口/*あ&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-9" title="9">  i <span class="op">=</span> <span class="st">&quot;v1.!口/*い&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-10" title="10">  u <span class="op">=</span> <span class="st">&quot;v1.!口/*う&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-11" title="11">  e <span class="op">=</span> <span class="st">&quot;v1.!口/*え&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-12" title="12">  o <span class="op">=</span> <span class="st">&quot;v1.!口/*お&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-13" title="13">  <span class="cn">N</span> <span class="op">=</span> <span class="st">&quot;v1.!口/*ん&quot;</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="op">}</span></a>
<a class="sourceLine" id="cb4-15" title="15"></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="co">-- ちなみに CeVIO で使われる音素は以下のようなものですが、</span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="co">-- lab ファイルを書き出すソフトによっては方言があるかもしれません</span></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="co">--   pau</span></a>
<a class="sourceLine" id="cb4-19" title="19"><span class="co">--     無音部分</span></a>
<a class="sourceLine" id="cb4-20" title="20"><span class="co">--   cl</span></a>
<a class="sourceLine" id="cb4-21" title="21"><span class="co">--     「っ」</span></a>
<a class="sourceLine" id="cb4-22" title="22"><span class="co">--   a/i/u/e/o</span></a>
<a class="sourceLine" id="cb4-23" title="23"><span class="co">--     母音</span></a>
<a class="sourceLine" id="cb4-24" title="24"><span class="co">--   A/I/U/E/O</span></a>
<a class="sourceLine" id="cb4-25" title="25"><span class="co">--     無声化された母音</span></a>
<a class="sourceLine" id="cb4-26" title="26"><span class="co">--     ※例「洗濯機」→「s/e/N/t/a/k/U/k/i」</span></a>
<a class="sourceLine" id="cb4-27" title="27"><span class="co">--   N</span></a>
<a class="sourceLine" id="cb4-28" title="28"><span class="co">--     「ん」</span></a>
<a class="sourceLine" id="cb4-29" title="29"><span class="co">--   k/s/t/n/h/m/y/r/w/g/z/d/b/p</span></a>
<a class="sourceLine" id="cb4-30" title="30"><span class="co">--   ky/sh/ch/ny/hy/my/ry/gy/j/by/py</span></a>
<a class="sourceLine" id="cb4-31" title="31"><span class="co">--     子音</span></a>
<a class="sourceLine" id="cb4-32" title="32"></a>
<a class="sourceLine" id="cb4-33" title="33"><span class="co">-- 無声化された母音は通常の母音を使いまわす</span></a>
<a class="sourceLine" id="cb4-34" title="34"><span class="co">--（やらない方が自然にみえることもあります）</span></a>
<a class="sourceLine" id="cb4-35" title="35">patterns<span class="op">.</span><span class="cn">A</span> <span class="op">=</span> patterns<span class="op">.</span><span class="cn">A</span> <span class="kw">or</span> patterns<span class="op">.</span>a <span class="kw">or</span> <span class="kw">nil</span></a>
<a class="sourceLine" id="cb4-36" title="36">patterns<span class="op">.</span><span class="cn">I</span> <span class="op">=</span> patterns<span class="op">.</span><span class="cn">I</span> <span class="kw">or</span> patterns<span class="op">.</span>i <span class="kw">or</span> <span class="kw">nil</span></a>
<a class="sourceLine" id="cb4-37" title="37">patterns<span class="op">.</span><span class="cn">U</span> <span class="op">=</span> patterns<span class="op">.</span><span class="cn">U</span> <span class="kw">or</span> patterns<span class="op">.</span>u <span class="kw">or</span> <span class="kw">nil</span></a>
<a class="sourceLine" id="cb4-38" title="38">patterns<span class="op">.</span><span class="cn">E</span> <span class="op">=</span> patterns<span class="op">.</span><span class="cn">E</span> <span class="kw">or</span> patterns<span class="op">.</span>e <span class="kw">or</span> <span class="kw">nil</span></a>
<a class="sourceLine" id="cb4-39" title="39">patterns<span class="op">.</span><span class="cn">O</span> <span class="op">=</span> patterns<span class="op">.</span><span class="cn">O</span> <span class="kw">or</span> patterns<span class="op">.</span>o <span class="kw">or</span> <span class="kw">nil</span></a>
<a class="sourceLine" id="cb4-40" title="40"><span class="co">-- pau は N を割り当て</span></a>
<a class="sourceLine" id="cb4-41" title="41">patterns<span class="op">.</span>pau <span class="op">=</span> patterns<span class="op">.</span>pau <span class="kw">or</span> patterns<span class="op">.</span><span class="cn">N</span> <span class="kw">or</span> <span class="kw">nil</span></a>
<a class="sourceLine" id="cb4-42" title="42"></a>
<a class="sourceLine" id="cb4-43" title="43"><span class="co">-- 現在のPSDオブジェクトから音量と音素情報を取得</span></a>
<a class="sourceLine" id="cb4-44" title="44"><span class="kw">local</span> ts <span class="op">=</span> <span class="cn">PSD</span><span class="op">.</span>talkstate</a>
<a class="sourceLine" id="cb4-45" title="45"><span class="co">-- ts には以下のプロパティがあります</span></a>
<a class="sourceLine" id="cb4-46" title="46"><span class="co">--   number  ts.frame        「口パク準備」基準でのフレーム数</span></a>
<a class="sourceLine" id="cb4-47" title="47"><span class="co">--   number  ts.time         「口パク準備」基準での時間（秒）</span></a>
<a class="sourceLine" id="cb4-48" title="48"><span class="co">--   number  ts.totalframe   「口パク準備」基準での総フレーム数</span></a>
<a class="sourceLine" id="cb4-49" title="49"><span class="co">--   number  ts.totaltime    「口パク準備」基準での総時間（秒）</span></a>
<a class="sourceLine" id="cb4-50" title="50"><span class="co">--   number  ts.wavfile      「口パク準備」で設定された *.wav ファイル名</span></a>
<a class="sourceLine" id="cb4-51" title="51"><span class="co">--   number  ts.locut        「口パク準備」で設定されたローカット周波数</span></a>
<a class="sourceLine" id="cb4-52" title="52"><span class="co">--   number  ts.hicut        「口パク準備」で設定されたハイカット周波数</span></a>
<a class="sourceLine" id="cb4-53" title="53"><span class="co">--   number  ts.threshold    「口パク準備」で設定されたしきい値</span></a>
<a class="sourceLine" id="cb4-54" title="54"><span class="co">--   number  ts.deflocut     「PSD ファイルオブジェクト」で設定されたローカット周波数</span></a>
<a class="sourceLine" id="cb4-55" title="55"><span class="co">--   number  ts.defhicut     「PSD ファイルオブジェクト」で設定されたハイカット周波数</span></a>
<a class="sourceLine" id="cb4-56" title="56"><span class="co">--   number  ts.defthreshold 「PSD ファイルオブジェクト」で設定されたしきい値</span></a>
<a class="sourceLine" id="cb4-57" title="57"><span class="co">--   number  ts.progress     現在の音素の開始地点を0、終了地点を1とした時の現在位置</span></a>
<a class="sourceLine" id="cb4-58" title="58"><span class="co">--   string  ts.cur          発音中の音素（ない時は空文字列）</span></a>
<a class="sourceLine" id="cb4-59" title="59"><span class="co">--   number  ts.cur_start    音素が始まる時間（ない時は0）</span></a>
<a class="sourceLine" id="cb4-60" title="60"><span class="co">--   number  ts.cur_end      音素が終わる時間（ない時は0）</span></a>
<a class="sourceLine" id="cb4-61" title="61"><span class="co">--   string  ts.prev         前の音素（ない時は空文字列）</span></a>
<a class="sourceLine" id="cb4-62" title="62"><span class="co">--   number  ts.prev_start   音素が始まる時間（ない時は0）</span></a>
<a class="sourceLine" id="cb4-63" title="63"><span class="co">--   number  ts.prev_end     音素が終わる時間（ない時は0）</span></a>
<a class="sourceLine" id="cb4-64" title="64"><span class="co">--   string  ts.next         次の音素（ない時は空文字列）</span></a>
<a class="sourceLine" id="cb4-65" title="65"><span class="co">--   number  ts.next_start   音素が始まる時間（ない時は0）</span></a>
<a class="sourceLine" id="cb4-66" title="66"><span class="co">--   number  ts.next_end     音素が終わる時間（ない時は0）</span></a>
<a class="sourceLine" id="cb4-67" title="67"><span class="co">-- ts には以下のメソッドがあります</span></a>
<a class="sourceLine" id="cb4-68" title="68"><span class="co">--   number  ts:getvolume()   現在の音量を取得します</span></a>
<a class="sourceLine" id="cb4-69" title="69"><span class="co">--   boolean ts:curisvowel()  現在発音中の音素が母音の時に 1、無声化された母音の時に -1、それ以外の時に 0</span></a>
<a class="sourceLine" id="cb4-70" title="70"><span class="co">--   boolean ts:previsvowel() 前の音素が母音の時に 1、無声化された母音の時に -1、それ以外の時に 0</span></a>
<a class="sourceLine" id="cb4-71" title="71"><span class="co">--   boolean ts:nextisvowel() 次の音素が母音の時に 1、無声化された母音の時に -1、それ以外の時に 0</span></a>
<a class="sourceLine" id="cb4-72" title="72"><span class="co">-- ただし未設定の場合など、ts が正しく取得できない場合は nil です</span></a>
<a class="sourceLine" id="cb4-73" title="73"><span class="co">-- また *.lab ファイルのタイムラインへのドラッグ＆ドロップにより音素情報を直接タイムライン上に持っている場合は</span></a>
<a class="sourceLine" id="cb4-74" title="74"><span class="co">-- ts.prev や ts.next などのプロパティにはデータが入りません</span></a>
<a class="sourceLine" id="cb4-75" title="75"></a>
<a class="sourceLine" id="cb4-76" title="76"><span class="cf">if</span> ts <span class="op">==</span> <span class="kw">nil</span> <span class="cf">then</span></a>
<a class="sourceLine" id="cb4-77" title="77">  <span class="co">-- 音素情報が取得できなかった時は「ん」のパターンを割り当て</span></a>
<a class="sourceLine" id="cb4-78" title="78">  <span class="co">-- PSD:addstate を使うと現在のPSDファイルのレイヤー表示に対して状態を追記できます</span></a>
<a class="sourceLine" id="cb4-79" title="79">  <span class="cn">PSD</span><span class="op">:</span>addstate<span class="op">(</span>patterns<span class="op">.</span><span class="cn">N</span><span class="op">)</span></a>
<a class="sourceLine" id="cb4-80" title="80"><span class="cf">else</span></a>
<a class="sourceLine" id="cb4-81" title="81">  <span class="co">-- この音素用のパターンが設定されている場合はそれを使う</span></a>
<a class="sourceLine" id="cb4-82" title="82">  <span class="cf">if</span> patterns<span class="op">[</span>ts<span class="op">.</span>cur<span class="op">]</span> <span class="op">~=</span> <span class="kw">nil</span> <span class="kw">and</span> patterns<span class="op">[</span>ts<span class="op">.</span>cur<span class="op">]</span> <span class="op">~=</span> <span class="st">&quot;&quot;</span> <span class="cf">then</span></a>
<a class="sourceLine" id="cb4-83" title="83">    <span class="cn">PSD</span><span class="op">:</span>addstate<span class="op">(</span>patterns<span class="op">[</span>ts<span class="op">.</span>cur<span class="op">])</span></a>
<a class="sourceLine" id="cb4-84" title="84">  <span class="cf">else</span></a>
<a class="sourceLine" id="cb4-85" title="85">    <span class="co">-- 音素用のパターンが見つからなかった場合は</span></a>
<a class="sourceLine" id="cb4-86" title="86">    <span class="co">-- 前の母音をそのまま引き継いでみる</span></a>
<a class="sourceLine" id="cb4-87" title="87">    <span class="cf">if</span> ts<span class="op">.</span>prev_end <span class="op">==</span> ts<span class="op">.</span>cur_start <span class="kw">and</span> ts<span class="op">:</span>previsvowel<span class="op">()</span> <span class="op">~=</span> <span class="dv">0</span> <span class="cf">then</span></a>
<a class="sourceLine" id="cb4-88" title="88">      <span class="cn">PSD</span><span class="op">:</span>addstate<span class="op">(</span>patterns<span class="op">[</span>ts<span class="op">.</span>prev<span class="op">])</span></a>
<a class="sourceLine" id="cb4-89" title="89">    <span class="cf">else</span></a>
<a class="sourceLine" id="cb4-90" title="90">      <span class="co">-- 上手く引き継げない時は「ん」でお茶を濁す</span></a>
<a class="sourceLine" id="cb4-91" title="91">      <span class="cn">PSD</span><span class="op">:</span>addstate<span class="op">(</span>patterns<span class="op">.</span><span class="cn">N</span><span class="op">)</span></a>
<a class="sourceLine" id="cb4-92" title="92">    <span class="cf">end</span></a>
<a class="sourceLine" id="cb4-93" title="93">  <span class="cf">end</span></a>
<a class="sourceLine" id="cb4-94" title="94"><span class="cf">end</span></a></code></pre></div>
<h2 id=".E3.83.91.E3.83.BC.E3.83.84.E5.B7.AE.E3.81.97.E6.9B.BF.E3.81.88.40PSD">パーツ差し替え@PSD</h2>
<p><code>パーツ差し替え</code> は拡張編集上のスライダーでレイヤーを切り替えできるようにする <code>アニメーション効果</code> で、言わば <a href="tutorial.html#*.anm_.E3.83.95.E3.82.A1.E3.82.A4.E3.83.AB.E3.82.92.E4.BD.9C.E6.88.90.E3.81.99.E3.82.8B">同じ階層のレイヤーをエクスポート</a> の簡易版です。</p>
<p>拡張編集の <code>パラメータ設定</code> ダイアログには 255 バイトの容量上限がありパーツ数が多いと上手く保存されないので、たくさんの項目を登録する場合は同じ階層のレイヤーをエクスポートを利用してください。</p>
<table>
<thead>
<tr class="header">
<th>プロパティ名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>パーツ</code></td>
<td>設定したパーツのどれを使うかを選択するスライダーです。<br><code>0</code> - パーツを使用しない<br><code>1</code>～<code>8</code> - 選択したパーツを使用する</td>
</tr>
</tbody>
</table>
<p><code>設定</code> ボタンを押すと以下のプロパティがあります。</p>
<table>
<thead>
<tr class="header">
<th>プロパティ名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>1</code>～<code>8</code></td>
<td>表示するレイヤーを割り当てます。</td>
</tr>
</tbody>
</table>
</div>
<footer>
<dl>
<dt>Written by</dt>
<dd>oov</dd>
<dt>Generated at</dt>
<dd>2022-04-12 01:24:55</dd>
<dt>for</dt>
<dd>v0.2.0beta59 ( 13efac7 )</dd>
</dl>
</footer>
</div>
</body>
</html>
